PROGRAMS = nargs ret err

all: $(PROGRAMS:%=%_go.log)

nargs_go.log: nargs_test.go autogenerated_nargs_test.go
	go test -bench 'Benchmark.*Arg' -cpu 1 | tee $@.tmp
	mv -f $@.tmp $@

ret_go.log: autogenerated_ret_test.go
	go test -bench 'Benchmark.*Ret' -cpu 1 | tee $@.tmp
	mv -f $@.tmp $@

err_go.log: autogenerated_err_test.go
	go test -bench 'Benchmark(Err|NoErr|Exc)' -cpu 1 -benchtime 2s -timeout 120m | tee $@.tmp
	mv -f $@.tmp $@

autogenerated_%_test.go: gen_%.sh
	bash gen_$*.sh >$@.tmp
	mv -f $@.tmp $@

clean:
	for i in $(PROGRAMS); do \
		rm -f autogenerated_$${i}_test.go $$i.log; \
	done
	rm -f go.test
	rm -f *\~ \#*
