CPPBENCH_DIR = ../../cppbench
CPPBENCH_DEPS = $(CPPBENCH_DIR)/bench.cc $(CPPBENCH_DIR)/bench.hh
NARGS_DEPS = autogenerated_nargs.cc

CXXFLAGS = -std=c++17 -O3 -fomit-frame-pointer

all: nargs_cpp.log

nargs_cpp.log: nargs
	./nargs 2>&1 | tee $@.tmp
	mv -f $@.tmp $@

nargs: nargs.cc $(NARGS_DEPS) $(CPPBENCH_DEPS)
	$(CXX) $(CXXFLAGS) -I$(CPPBENCH_DIR) nargs.cc $(CPPBENCH_DIR)/bench.cc -o $@

autogenerated_nargs.cc: gen_nargs.sh
	bash gen_nargs.sh >$@.tmp
	mv -f $@.tmp $@

clean:
	rm -f nargs autogenerated_nargs.cc nargs.log
	rm -f *\~ \#*
